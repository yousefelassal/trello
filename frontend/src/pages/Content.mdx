<h1 className="text-4xl py-2 font-bold">Docuemntation</h1>

<h2 className="text-2xl font-semibold">Client State</h2>

A custom hook was created to get the user token on first render from local storage and set the token value on login and signup using `jotai` util <span className="underline">[`atomWithStorage`](https://jotai.org/docs/utilities/storage)</span>

<CH.Code>

```ts useTokenValue.ts mark=4[20:34],7[29:35]
import { useAtom } from "jotai";
import { atomWithStorage } from "jotai/utils";

const tokenValue = atomWithStorage<string | null>('trello-3al-daya2-token', null)

export const useTokenValue = () => {
  const [token, setToken] = useAtom(tokenValue)

  return {
    token,
    setToken
  }
}
```

```tsx App.tsx focus=1,4,6[7:12],14,15
import { useTokenValue } from "./hooks/useTokenValue";

function App() {
  const { token, setToken } = useTokenValue()

  if (token) {
    return (
      // user is logged in and dashboard is rendered
    )
  }

  return (
    // user is not logged in and landing page is rendered with login and signup
      <Route path="/login" element={<Login setToken={setToken} />} />
      <Route path="/signup" element={<Signup setToken={setToken} />} />
  );
}

```

</CH.Code>

<h2 className="text-2xl font-semibold">Server State</h2>

<CH.Section>

```tsx main.tsx
import ReactDOM from 'react-dom/client'
import ApolloProvider from './components/ApolloProvider.tsx'

ReactDOM.createRoot(document.getElementById('root')!).render(
  <ApolloProvider>
    <Router>
      <App />
    </Router>
  </ApolloProvider>
)
```
A custom [ApolloProvider](focus://2,5,9) component was created to wrap the app with the apollo client and set the authorization header with the user token from local storage

</CH.Section>

<CH.Scrollycoding>

<h3 className="text-lg font-semibold">Using Token</h3>

`useTokenValue` is used imported and used to get the user token

```tsx ApolloProvider.tsx focus=1,8
import { useTokenValue } from '@/hooks/useTokenValue'

interface Props {
  children: React.ReactNode
}

const ApolloProvider = ({children}:Props) => {
  const { token } = useTokenValue()

  const httpLink = createHttpLink({
    uri: import.meta.env.VITE_SERVER,
  })
  
  const client = new ApolloClient({
    cache: new InMemoryCache(),
    link: authLink.concat(httpLink),
  })

  return (
    <Provider client={client}>
      {children}
    </Provider>
  )
}

export default ApolloProvider
```

---

<h3 className="text-lg font-semibold">User Context</h3>

`setContext` is used to set the authorization header with the user token


```tsx ApolloProvider.tsx focus=1,10:17
import { setContext } from '@apollo/client/link/context'
import { useTokenValue } from '@/hooks/useTokenValue'

interface Props {
  children: React.ReactNode
}

const ApolloProvider = ({children}:Props) => {
  const { token } = useTokenValue()
  const authLink = setContext((_, { headers }) => {
    return {
        headers: {
          ...headers,
          authorization: token ? `Bearer ${token}` : null,
        }
    }
  })
  const httpLink = createHttpLink({
    uri: import.meta.env.VITE_SERVER,
  })
  
  const client = new ApolloClient({
    cache: new InMemoryCache(),
    link: authLink.concat(httpLink),
  })

  return (
    <Provider client={client}>
      {children}
    </Provider>
  )
}

export default ApolloProvider
```

---

<h3 className="text-lg font-semibold">Apollo Client</h3>

The apollo client is created with the `authLink` created and `httpLink` from the server uri which is set in the `.env` file according to the environment (development or production)

<CH.Code>

```tsx ApolloProvider.tsx focus=1:6,24:37
import {
  ApolloClient,
  ApolloProvider as Provider,
  InMemoryCache,
  createHttpLink,
} from '@apollo/client'
import { setContext } from '@apollo/client/link/context'
import { useTokenValue } from '@/hooks/useTokenValue'

interface Props {
  children: React.ReactNode
}

const ApolloProvider = ({children}:Props) => {
  const { token } = useTokenValue()
  const authLink = setContext((_, { headers }) => {
    return {
        headers: {
          ...headers,
          authorization: token ? `Bearer ${token}` : null,
        }
    }
  })
  const httpLink = createHttpLink({
    uri: import.meta.env.VITE_SERVER,
  })
  
  const client = new ApolloClient({
    cache: new InMemoryCache(),
    link: authLink.concat(httpLink),
  })

  return (
    <Provider client={client}>
      {children}
    </Provider>
  )
}

export default ApolloProvider
```

---

```env .env
VITE_SERVER=http://localhost:4000/graphql
```

</CH.Code>


</CH.Scrollycoding>

Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Praesent elementum facilisis leo vel fringilla est ullamcorper eget. At imperdiet dui accumsan sit amet nulla facilities morbi tempus. Praesent elementum facilisis leo vel fringilla. Congue mauris rhoncus aenean vel. Egestas sed tempus urna et pharetra pharetra massa massa ultricies.

Consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Praesent elementum facilisis leo vel fringilla est ullamcorper eget. At imperdiet dui accumsan sit amet nulla facilities morbi tempus. Praesent elementum facilisis leo vel fringilla. Congue mauris rhoncus aenean vel. Egestas sed tempus urna et pharetra pharetra massa massa ultricies.

# Spotlight

This is how to use the `<CH.Spotlight>` component. Lorem ipsum dolor sit amet consectetur adipisicing elit. Quisquam, quia! Quidem, quisquam.

<CH.Spotlight>

```js app.js
function lorem(ipsum, dolor = 1) {
  const sit = ipsum == null && 0
  dolor = sit - amet(dolor)
  return sit ? consectetur(ipsum) : []
}
```

---

Change focus

```js app.js focus=2:4

```

---

Or change the code

```js app.js focus=6:10
function lorem(ipsum, dolor = 1) {
  const sit = ipsum == null && 0
  dolor = sit - amet(dolor)
  return sit ? consectetur(ipsum) : []
}

function adipiscing(...elit) {
  console.log(elit)
  return elit.map((ipsum) => ipsum.sit)
}
```

---

Or change the file

<CH.Code>

```js app.js focus=1:4
function adipiscing(...elit) {
  console.log(elit)
  return elit.map((ipsum) => ipsum.sit)
}
```

---

```css styles.css
.lorem {
  color: #fff;
  padding: 10px;
  background: #000;
}
```

</CH.Code>

---

### By the way

- you can
- put any
- markdown
- here

üëç

```js app.js

```

</CH.Spotlight>